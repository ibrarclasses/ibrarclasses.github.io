<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stationery Mall | Ibrar Classes</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* ====== BASIC / THEME ====== */
    :root {
      --primary: #3B82F6;
      --accent: #10B981;
      --nav: #0b1220;
      --bg: #F0F4F8;
      --card: #ffffff;
      --text: #1F2937;
      --filter-width: 240px;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      margin: 0; padding: 0;
      background-color: var(--bg);
      background-image: url('background-edu.png');
      background-size: cover;
      background-attachment: fixed;
      background-position: center top;
      background-repeat: no-repeat;
      color: var(--text);
      transition: background-color .4s, color .4s;
      overflow-x: hidden;
    }

    /* ====== HEADER ====== */
    header {
      text-align: center;
      padding: 2rem 1rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
      position: relative;
    }
    header img { width: 90px; border-radius: 50%; margin-bottom: 10px; object-fit: cover; }
    header h1 { margin: 0; font-size: 2rem; }
    header p { margin: .35rem 0; font-weight: 500; }

        /* ====== NAV BAR ====== */
    nav {
      background: var(--nav);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.7rem 1.5rem;
      position: sticky;
      top: 0;
      z-index: 1000;
      flex-wrap: wrap;
    }

    nav .left-links {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }

    nav .left-links a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      transition: color 0.3s, transform 0.2s;
    }

    nav .left-links a:hover {
      color: var(--accent);
      transform: scale(1.05);
    }
    nav .right-section {
  margin-left: auto;
  display: flex;
  align-items: center;
}

    /* Premium gradient search bar styling */
#searchBarContainer {
  display: flex;
  align-items: center;
  background: linear-gradient(135deg, #00c6ff, #0072ff);
  border-radius: 50px;
  padding: 2px;
  transition: all 0.3s ease;
}

#searchInput {
  border: none;
  outline: none;
  padding: 8px 12px;
  border-radius: 50px 0 0 50px;
  width: 150px;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

/* Expanding input when focused */
#searchInput:focus {
  width: 200px;
  background: #fff;
}

/* Gradient search button */
#searchBtn {
  border: none;
  padding: 8px 15px;
  border-radius: 0 50px 50px 0;
  cursor: pointer;
  color: white;
  font-weight: 600;
  background: linear-gradient(135deg, #0072ff, #00c6ff);
  transition: all 0.3s ease;
}

/* Button hover glow */
#searchBtn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 8px rgba(0, 198, 255, 0.6);
}

/* Smooth shadow around full bar */
#searchBarContainer:focus-within {
  box-shadow: 0 0 10px rgba(0, 198, 255, 0.7);
}

    /* ====== TICKER / MOVING NOTICE (keeps your style) ====== */
    .ticker { width:100%; overflow:hidden; background:linear-gradient(90deg,#2563eb,#10b981); color:white; font-weight:600; padding:8px 0; position:relative;
      border-top:2px solid rgba(255,255,255,.2); border-bottom:2px solid rgba(255,255,255,.2); box-shadow:inset 0 -3px 6px rgba(0,0,0,.1);
    }
    .ticker__content { display:inline-block; white-space:nowrap; position:relative; will-change:transform; }
    @keyframes scrollText { from { transform: translateX(var(--start)); } to { transform: translateX(var(--end)); } }
    .ticker:hover .ticker__content { animation-play-state: paused !important; }

   /* ====== LIVE DATETIME ====== */
    #live-datetime {
      position: fixed;
      top: 12px;
      right: 18px;
      z-index: 1100;
      background: rgba(255, 255, 255, 0.88);
      color: #0b1220;
      padding: 7px 12px;
      border-radius: 9px;
      font-size: 13px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
      backdrop-filter: blur(4px);
    }
    
    /* ====== LAYOUT: filters (left) + main (right) ====== */
    .layout {
      max-width: 1200px;
      margin: 1.5rem auto;
      display: grid;
      grid-template-columns: var(--filter-width) 1fr;
      gap: 1.5rem;
      padding: 0 1rem;
    }

    /* Filter panel */
    .filters {
      background: rgba(255,255,255,0.96);
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 6px 22px rgba(6,24,44,0.06);
      position: sticky;
      top: 84px; /* under nav/header */
      height: fit-content;
      align-self: start;
    }
    .filters h3 { margin: 0 0 8px 0; color: var(--nav); font-size: 1rem; }
    .filter-list { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
    .filter-item { display:flex; align-items:center; gap:8px; }
    .filter-item input[type="checkbox"] { width:16px; height:16px; }
    .filter-actions { margin-top:10px; display:flex; gap:8px; }
    .filter-actions button { padding:6px 10px; border-radius:8px; border:none; background:linear-gradient(135deg,var(--accent),var(--primary)); color:#fff; cursor:pointer; }

    /* Main column keeps product grid and other content */
    .main {
      display:flex; flex-direction:column; gap:1.5rem;
    }

    .container {
      padding: 1.5rem;
      background: rgba(255,255,255,0.96);
      border-radius: 14px;
      box-shadow: 0 6px 22px rgba(6,24,44,0.06);
    }

    h2 { text-align:center; color:var(--primary); margin-bottom:1rem; }

    /* Product grid & cards (kept same look) */
    .product-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:1.5rem; }
    .product-card { background:white; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.1); padding:15px; text-align:center; transition:transform .2s ease; position:relative; }
    .product-card:hover { transform: translateY(-5px); }
    .product-card img { width:100%; height:180px; object-fit:contain; border-radius:10px; }
    .price { display:block; font-weight:bold; color:#1a73e8; margin: 6px 0; }

    .buy-btn { display:inline-block; background:linear-gradient(135deg,#2563eb,#3b82f6); color:#fff; font-weight:600; text-decoration:none; padding:10px 18px; border-radius:10px; box-shadow:0 4px 10px rgba(37,99,235,.3); transition:all .3s; margin-top:10px; position:relative; overflow:hidden; }
    .buy-btn:hover { background:linear-gradient(135deg,#1d4ed8,#60a5fa); transform:translateY(-3px); box-shadow:0 6px 15px rgba(37,99,235,.5); }
    .buy-btn::after { content:""; position:absolute; top:0; left:-100%; width:100%; height:100%; background:rgba(255,255,255,.3); transform:skewX(-20deg); transition:.5s; }
    .buy-btn:hover::after { left:100%; }

    /* Source tag basic style (we animate and color in JS) */
    .source-tag { position:absolute; top:10px; right:10px; color:#fff; font-size:12px; font-weight:600; padding:4px 10px; border-radius:14px; }

    /* ====== FOOTER ====== */
    footer { background:var(--nav); color:#fff; text-align:center; padding:16px 10px; margin-top:28px; font-size:14px; }
    #visitor-info { margin-top:8px; font-weight:600; }

    /* ====== FLOATING UI ====== */
    #molly-chat { position: fixed; bottom: 18px; right: 18px; z-index: 2000; width:72px; height:72px; border-radius:50%; background:#fff; display:flex; align-items:center; justify-content:center; box-shadow:0 8px 26px rgba(3,10,23,.18); text-decoration:none; animation:pulse 2.5s infinite; }
    .molly-avatar{ width:66px; height:66px; border-radius:50%; object-fit:cover; }

    /* Back to top */
    #back-to-top { position:fixed; right:18px; bottom:108px; display:none; z-index:1500; background:var(--primary); color:#fff; border:none; width:46px; height:46px; border-radius:50%; box-shadow:0 6px 20px rgba(2,6,23,.16); cursor:pointer; font-weight:700; }
    #back-to-top:hover { background:var(--accent); }

    /* Dark mode (preserves your variables) */
    .dark-mode { --primary:#60a5fa; --accent:#34d399; --nav:#0b1220; --bg:#0b1220; --card:#071129; --text:#000000; }
    /* ensure dark mode content readability for elements using hard-coded colors */
    .dark-mode header, .dark-mode nav { filter: none; }
    .dark-mode .container, .dark-mode .filters, .dark-mode .main { background: rgba(6,10,20,0.85); color: #e6eefc; }
    .dark-mode .product-card { background: rgba(10,14,25,0.8); color: #e6eefc; }
    .dark-mode .buy-btn::after { background: rgba(255,255,255,.06); }

    /* Make sure the dark-mode toggle stays visible and above header */
    #darkModeToggle {
      position: fixed; top: 14px; left: 14px; z-index: 2001; width:46px; height:46px; border-radius:50%; border:none; cursor:pointer;
      background: rgba(255,255,255,0.92); color:var(--nav); font-size:18px; box-shadow:0 6px 18px rgba(2,6,23,.12);
    }
    #darkModeToggle:hover { transform: scale(1.06); }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 960px) {
      .layout { grid-template-columns: 1fr; padding: 0 12px; }
      .filters { position: relative; top: auto; display:none; } /* hide side filters on tablet by default */
      .filters.open { display:block; margin-bottom: 12px; } /* when toggled open */
    }
    @media (max-width: 420px) {
      #searchInput { display: none; } /* keep nav tidy on very small screens - only search icon shows */
      #searchBarContainer { padding:4px; }
      #searchBtn { padding:8px; }
    }

    /* keyframes */
    @keyframes pulse { 0%{ box-shadow:0 0 0 0 rgba(16,185,129,.28);} 70% { box-shadow:0 0 0 16px rgba(16,185,129,0);} 100%{ box-shadow:0 0 0 0 rgba(16,185,129,0); } }
  </style>
</head>
<body>

  <!-- Live date/time -->
  <div id="live-datetime" aria-hidden="false"></div>

  <!-- Dark mode toggle -->
  <button id="darkModeToggle" title="Toggle dark mode">üåô</button>

  <header>
    <img src="logost.png" alt="Stationery logo" />
    <h1>Stationery Mall üõí</h1>
    <p>Here you'll find UPSC & other study essentials. These are affiliate links and we may earn a small referral fee when you purchase from here, at no extra cost to you ‚ù§Ô∏è!</p>
  </header>

  <nav>
    <div class="left-links">
      <a href="index.html">Home</a>
    </div>

    <div class="right-section">
      <!-- keep search bar in nav with same look; note: not prefilled -->
      <div id="searchBarContainer" style="color:transparent;">
        <input id="searchInput" type="text" placeholder="Search products..." aria-label="Search products" />
        <button id="searchBtn" aria-label="Search">üîç</button>
      </div>
    </div>
  </nav>

  <!-- Ticker -->
  <div class="ticker">
    <div class="ticker__content" id="tickerText"></div>
  </div>

  <!-- Layout: left filters + main -->
  <div class="layout">

    <!-- Filters column (left) -->
    <aside class="filters" id="filtersPanel" aria-hidden="false">
      <h3>Filters</h3>
      <div class="filter-list" id="filterList">
        <!-- checkboxes injected by JS (demo categories used) -->
      </div>
      <div class="filter-actions">
        <button id="clearFilters">Clear</button>
        <button id="saveFiltersBtn">Save</button>
      </div>
      <hr style="margin:12px 0;border:none;border-top:1px solid #eef2f7;">
      <div style="font-size:0.9rem;color:#556074">Other tools</div>
      <ul style="padding-left:16px;margin-top:8px;color:#334155">
      </ul>
    </aside>

    <!-- Main column (right) -->
    <div class="main">
      <div class="container" aria-live="polite">
        <div class="product-grid" id="productGrid"></div>
      </div>
    </div>
  </div>

  <footer>
    <div>&copy; 2025 Ibrar Classes</div>
    <div id="visitor-info" aria-live="polite"></div>
  </footer>

  <!-- Miss Molly chat -->
  <a id="molly-chat" href="https://t.me/M1ssMolly_Bot" target="_blank" rel="noopener" title="Chat with Miss Molly">
    <img src="images/miss-molly.jpg" alt="Miss Molly" class="molly-avatar" />
  </a>

  <!-- Back to top -->
  <button id="back-to-top" aria-label="Back to top">‚Üë</button>

  <!-- ========== SCRIPTS ========== -->
  <script>
    /* ===== LIVE DATETIME ===== */
    function updateDateTime(){
      const now = new Date();
      const options = { weekday:'short', year:'numeric', month:'short', day:'numeric' };
      const dateStr = now.toLocaleDateString('en-IN', options);
      const timeStr = now.toLocaleTimeString('en-IN');
      document.getElementById('live-datetime').textContent = `${dateStr} | ${timeStr}`;
    }
    updateDateTime(); setInterval(updateDateTime, 1000);

    /* ===== DARK MODE ===== */
    const darkToggle = document.getElementById('darkModeToggle');
    if(localStorage.getItem('ibrar-dark') === '1'){ document.documentElement.classList.add('dark-mode'); darkToggle.textContent='‚òÄÔ∏è'; }
    darkToggle.addEventListener('click', ()=>{
      document.documentElement.classList.toggle('dark-mode');
      const isDark = document.documentElement.classList.contains('dark-mode');
      localStorage.setItem('ibrar-dark', isDark? '1':'0');
      darkToggle.textContent = isDark? '‚òÄÔ∏è' : 'üåô';
    });


    /* ===== FAKE VISITOR COUNT (50-100) ===== */
    (function visitorCounter(){
      const KEY_COUNT='ibrar_visitors', KEY_RESET='ibrar_visitors_reset';
      const resetDays = 30; const now = Date.now();
      const lastReset = localStorage.getItem(KEY_RESET);
      let count = parseInt(localStorage.getItem(KEY_COUNT),10);
      function randomInRange(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
      if(!lastReset || (now - lastReset) > resetDays*24*60*60*1000){
        count = randomInRange(51,98); localStorage.setItem(KEY_COUNT,count); localStorage.setItem(KEY_RESET,now);
      } else {
        if(!count || isNaN(count)){ count = randomInRange(51,98); localStorage.setItem(KEY_COUNT,count); }
        const inc = Math.random()<0.35?0:Math.random()<0.6?1:2; count = Math.min(98,count+inc); localStorage.setItem(KEY_COUNT,count);
      }
      const getActiveUsers = ()=> randomInRange(5,13);
      function renderVisitor(){
        const date = new Date().toLocaleDateString('en-IN',{year:'numeric',month:'short',day:'numeric'});
        const active = getActiveUsers();
        document.getElementById('visitor-info').innerHTML = `Visitors this month: <strong>${count}</strong> &nbsp; | &nbsp; Last updated: <strong>${date}</strong> &nbsp; | &nbsp; Active users: <strong>${active}</strong>`;
      }
      renderVisitor();
      setInterval(()=>{
        if(Math.random() < 0.45){ count = Math.min(98, count + (Math.random()<0.6?1:0)); localStorage.setItem(KEY_COUNT,count); }
        renderVisitor();
      },8000);
    })();

    /* ===== BACK TO TOP ===== */
    const backBtn = document.getElementById('back-to-top');
    window.addEventListener('scroll', ()=>{ backBtn.style.display = window.scrollY > 300 ? 'block' : 'none'; });
    backBtn.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

    /* ===== TICKER (keeps your working implementation) ===== */
    (function initTicker(){
      const messages = [
        "üõí These products are affiliate links from trusted sites like Flipkart, Amazon or Meesho.",
        "üì¶ The products are updated regularly for better deals and prices.",
        "‚ù§Ô∏è Handpicked products, curated list, you pay nothing extra, we get small referral fee. Win-Win ‚≠ê",
        "üîç Use the Search Bar to find the products quickly",
        "üí° Any feedbacks/Suggestions/Queries? Leave with Miss Molly ‚≠ê",
      ];
      const tickerText = document.getElementById("tickerText");
      const container = document.querySelector(".ticker");
      let current = 0; let timerId = null;
      const SPEED_PX_PER_SEC = 120;

      function showNextMessage(){
        if(timerId){ clearTimeout(timerId); timerId = null; }
        tickerText.textContent = messages[current];
        requestAnimationFrame(()=>{
          const textW = tickerText.offsetWidth, containerW = container.clientWidth;
          const startPx = containerW; const endPx = -textW;
          const distance = Math.abs(endPx - startPx);
          const durationMs = Math.max(4000, Math.round((distance / SPEED_PX_PER_SEC) * 1000));
          tickerText.style.setProperty('--start', startPx + 'px');
          tickerText.style.setProperty('--end', endPx + 'px');
          tickerText.style.animation = 'none'; void tickerText.offsetWidth;
          tickerText.style.animation = `scrollText ${durationMs}ms linear forwards`;
          const gapAfter = ((current+1) % messages.length === 0) ? 15000 : 5000;
          timerId = setTimeout(()=>{ current = (current+1)%messages.length; showNextMessage(); }, durationMs + gapAfter);
        });
      }
      showNextMessage();
      tickerText.parentElement.addEventListener('mouseenter', ()=> { tickerText.style.animationPlayState='paused'; });
      tickerText.parentElement.addEventListener('mouseleave', ()=> { tickerText.style.animationPlayState='running'; });
    })();

    /* ====== PRODUCT LOADING, SEARCH, FILTERS (single combined robust script) ====== */
    (function productModule(){
      const PRODUCTS_JSON = 'products.json?v=' + new Date().getTime();
      const grid = document.getElementById('productGrid');
      const searchInput = document.getElementById('searchInput');
      const searchBtn = document.getElementById('searchBtn');
      const filterListEl = document.getElementById('filterList');
      const filtersPanel = document.getElementById('filtersPanel');
      const clearBtn = document.getElementById('clearFilters');
      const saveBtn = document.getElementById('saveFiltersBtn');

      // demo categories (you can edit later). We'll also add any categories found in products.
      const demoCategories = ['Pens','Notebooks','Books','Accessories','Calculators','Highlighters'];
      let products = [];      // full list
      let activeFilters = JSON.parse(localStorage.getItem('ibrar_filters') || '[]'); // array of selected category names

      // Utility: extract source from URL
      function detectSource(url){
        if(!url) return '';
        const u = url.toLowerCase();
        if(u.includes('amzn') || u.includes('amazon')) return 'Amazon';
        if(u.includes('flipkart')) return 'Flipkart';
        if(u.includes('meesho')) return 'Meesho';
        return '';
      }

      // Build filter UI (prefers categories found in products, else demo)
      function buildFilterUI(categories){
        filterListEl.innerHTML = '';
        categories.forEach(cat=>{
          const id = 'filter_' + cat.replace(/\s+/g,'_').toLowerCase();
          const wrapper = document.createElement('label');
          wrapper.className = 'filter-item';
          wrapper.innerHTML = `<input type="checkbox" id="${id}" value="${cat}" ${activeFilters.includes(cat) ? 'checked' : ''} /> <span>${cat}</span>`;
          filterListEl.appendChild(wrapper);
          wrapper.querySelector('input').addEventListener('change', () => {
            syncFiltersFromUI();
            applyFiltersAndSearch();
          });
        });
      }

      function syncFiltersFromUI(){
        const checked = Array.from(filterListEl.querySelectorAll('input[type="checkbox"]:checked')).map(i=>i.value);
        activeFilters = checked;
        localStorage.setItem('ibrar_filters', JSON.stringify(activeFilters));
      }

      // display products (list = filtered list)
      function displayProducts(list){
        grid.innerHTML = '';
        if(!list || list.length === 0){
          grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#475569">No items found.</p>';
          return;
        }
        list.forEach(p=>{
          const card = document.createElement('div'); card.className = 'product-card';
          card.style.position = 'relative';

          const source = detectSource(p.link) || (p.source || '');
          // image with lazy loading and fallback
          const safeImage = p.image ? p.image : 'fallback.jpg';
          card.innerHTML = `
            <img src="${safeImage}" alt="${(p.title||'Stationery Product')}" loading="lazy" onerror="this.src='fallback.jpg';this.alt='Image not available';">
            <h3>${p.title || ''}</h3>
            <p style="color:#475569">${p.desc || ''}</p>
            <span class="price">${p.price || ''}</span>
            <a href="${p.link || '#'}" target="_blank" class="buy-btn" rel="nofollow noopener noreferrer">Buy Now</a>
          `;

          // Add source tag if available (animated & colored)
          if(source){
            const tag = document.createElement('div'); tag.className = 'source-tag'; tag.textContent = source;
            // color map
            const colors = { Amazon: '#FFD700', Flipkart:'#2874F0', Meesho:'#E91E63' };
            const col = colors[source] || '#444';
            // tag base style ‚Äî keep text white for visibility
            tag.style.background = col;
            tag.style.color = '#fff';
            tag.style.fontSize = '12px';
            tag.style.fontWeight = '600';
            tag.style.padding = '4px 10px';
            tag.style.borderRadius = '14px';
            tag.style.boxShadow = '0 2px 6px rgba(0,0,0,0.25)';
            tag.style.opacity = '0';
            tag.style.transform = 'translateY(-6px)';
            tag.style.transition = 'all .35s ease';
            tag.style.pointerEvents = 'none';

            // add per-platform pulse via dynamic style (uses colored glow)
            const keyframesName = 'tagPulse_' + source.toLowerCase();
            // if the keyframe does not exist yet, add it
            if(!document.getElementById('kf_' + keyframesName)){
              const styleEl = document.createElement('style');
              styleEl.id = 'kf_' + keyframesName;
              const rgba = hexToRgba(col, 0.6);
              styleEl.innerHTML = `
                @keyframes ${keyframesName} {
                  0%,100%{ box-shadow: 0 2px 6px rgba(0,0,0,0.25); transform: scale(1); }
                  50% { box-shadow: 0 0 14px 4px ${rgba}; transform: scale(1.05); }
                }
              `;
              document.head.appendChild(styleEl);
            }
            tag.style.animation = keyframesName + ' 4s infinite ease-in-out';
            card.appendChild(tag);
            // animate in
            requestAnimationFrame(()=> setTimeout(()=>{ tag.style.opacity='1'; tag.style.transform='translateY(0)'; },120));
          }

          grid.appendChild(card);
        });
      }

      // helper: hex to rgba
      function hexToRgba(hex, a){
        hex = hex.replace('#','');
        if(hex.length === 3) hex = hex.split('').map(h=>h+h).join('');
        const r = parseInt(hex.slice(0,2),16), g = parseInt(hex.slice(2,4),16), b = parseInt(hex.slice(4,6),16);
        return `rgba(${r},${g},${b},${a})`;
      }

      // apply the filters + search
      function applyFiltersAndSearch(){
        const q = (searchInput.value || '').toLowerCase().trim();
        let list = products.slice(); // copy

        // filter by categories if any selected (assume product.category or product.tags contains)
        if(activeFilters && activeFilters.length){
          list = list.filter(p => {
            // prefer explicit p.category
            if(p.category){
              return activeFilters.includes(p.category);
            }
            // fallback: check tags array or title/desc for category words
            if(Array.isArray(p.tags)){
              return p.tags.some(t => activeFilters.includes(t));
            }
            // last fallback: check title/desc contains any filter word
            return activeFilters.some(f => {
              const fl = f.toLowerCase();
              return (p.title && p.title.toLowerCase().includes(fl)) || (p.desc && p.desc.toLowerCase().includes(fl));
            });
          });
        }

        // apply search query
        if(q){
          list = list.filter(p => (p.title && p.title.toLowerCase().includes(q)) || (p.desc && p.desc.toLowerCase().includes(q)));
        }

        displayProducts(list);
      }

      // Search events (live)
      searchInput.addEventListener('input', () => {
        // if user clears input, show all (and keep filters applied)
        applyFiltersAndSearch();
      });
      searchInput.addEventListener('keyup', (e)=>{
        if(e.key === 'Enter') applyFiltersAndSearch();
      });
      searchBtn.addEventListener('click', applyFiltersAndSearch);

      // clear & save filter buttons
      clearBtn.addEventListener('click', ()=>{
        activeFilters = []; localStorage.removeItem('ibrar_filters');
        const boxes = filterListEl.querySelectorAll('input[type="checkbox"]'); boxes.forEach(b=>b.checked=false);
        applyFiltersAndSearch();
      });
      saveBtn.addEventListener('click', ()=> { localStorage.setItem('ibrar_filters', JSON.stringify(activeFilters)); alert('Filters saved locally.'); });

      // Build filters from demo + product categories (if any)
      function computeCategoriesFromProducts(prodList){
        const set = new Set(demoCategories);
        prodList.forEach(p=>{
          if(p.category) set.add(p.category);
          if(Array.isArray(p.tags)) p.tags.forEach(t => set.add(t));
        });
        return Array.from(set);
      }

      // fetch products.json and initialize UI
      async function init(){
        try {
          const res = await fetch(PRODUCTS_JSON);
          products = await res.json();
          // compute categories
          const cats = computeCategoriesFromProducts(products);
          buildFilterUI(cats);
          // initial display uses saved filters and blank search
          applyFiltersAndSearch();
        } catch(err){
          console.error('Error loading products:', err);
          grid.innerHTML = `<p style="text-align:center;color:red">‚ö†Ô∏è Failed to load products, please refresh the page.</p>`;
        }
      }

      init();

      // expose small helper for other scripts if needed
      window.ibrarProductsRefresh = applyFiltersAndSearch;

    })();

    /* ====== FILTERS PANEL TOGGLE ON MOBILE ====== */
    (function mobileFilterToggle(){
      // add a small toggle button to show/hide filters on small screens
      const btn = document.createElement('button');
      btn.id = 'filtersToggle';
      btn.innerHTML = 'Filters ‚§ì';
      btn.style.border = 'none';
      btn.style.padding = '8px 12px';
      btn.style.borderRadius = '8px';
      btn.style.background = 'linear-gradient(135deg,var(--accent),var(--primary))';
      btn.style.color = '#fff';
      btn.style.cursor = 'pointer';
      btn.style.marginLeft = '8px';
      btn.style.display = 'none';
      btn.style.zIndex = 1200;
      document.querySelector('nav .right-section').insertBefore(btn, document.querySelector('nav .right-section').children[0]);

      const filtersPanel = document.getElementById('filtersPanel');
      function updateDisplay(){
        if(window.innerWidth <= 960){
          btn.style.display = 'inline-block';
          filtersPanel.classList.remove('open');
        } else {
          btn.style.display = 'none';
          filtersPanel.classList.remove('open');
        }
      }
      btn.addEventListener('click', ()=> filtersPanel.classList.toggle('open'));
      window.addEventListener('resize', updateDisplay);
      updateDisplay();
    })();

  </script>
</body>
</html>
