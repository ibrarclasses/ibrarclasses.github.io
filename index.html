<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stationery Mall | Ibrar Classes</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary: #3B82F6;
      --accent: #10B981;
      --bg: #F0F4F8;
      --card: #fff;
      --text: #1F2937;

      /* mobile constants (used by JS too) */
      --header-height-mobile: 92px; /* initial estimation, will be measured & corrected by JS */
      --header-height-mobile-compact: 56px;
      --search-height: 60px;
    }

    *{ box-sizing: border-box; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }
    html,body{ height:100%; margin:0; padding:0; font-family:'Poppins',sans-serif; color:var(--text); background:var(--bg); }

    /* ---------------- DESKTOP / GLOBAL (unchanged look) ---------------- */
    header {
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      padding:2.2rem 1rem;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color:#fff;
      box-shadow: 0 4px 14px rgba(11, 13, 26, 0.18);
      transition: padding .28s ease, box-shadow .28s ease;
    }

    header .brand-row {
      display:flex;
      align-items:center;
      gap:18px;
      width:100%;
      max-width:1200px;
      justify-content:center;
    }

    header img { width:130px; height:130px; border-radius:50%; object-fit:cover; transition: width .28s ease, height .28s ease; box-shadow:0 8px 30px rgba(0,0,0,0.12); }
    header h1 { margin:0; font-size:3rem; font-weight:800; text-shadow:0 0 8px rgba(255,255,255,0.25); }
    header p { margin-top:0.8rem; font-weight:500; font-size:1.05rem; max-width:780px; text-align:center; }

    nav { background: linear-gradient(135deg,#10B981,#1486a5); display:flex; justify-content:space-between; align-items:center; gap:12px; padding:0.7rem 1.5rem; color:#fff; position:relative; z-index:900; }
    nav .left-links{ display:flex; gap:15px; align-items:center; }
    nav .right-section{ margin-left:auto; display:flex; gap:8px; align-items:center; }

    .layout{ max-width:1200px; margin:1.5rem auto; display:grid; grid-template-columns:240px 1fr; gap:1.5rem; padding:0 1rem; }
    .filters{ background:var(--card); border-radius:12px; padding:14px; box-shadow:0 6px 22px rgba(6,24,44,0.06); position:sticky; top:84px; align-self:start; }
    .main{ display:flex; flex-direction:column; gap:1.5rem; }
    .container{ padding:1.5rem; background:var(--card); border-radius:14px; box-shadow:0 6px 22px rgba(6,24,44,0.06); }
    .product-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:1.25rem; }

    /* desktop floating controls (stay visible on desktop) */
    #live-datetime{ position:fixed; top:12px; right:18px; background:rgba(255,255,255,0.92); padding:8px 12px; border-radius:9px; box-shadow:0 4px 12px rgba(2,6,23,0.12); z-index:950; font-size:13px; }
    #darkModeToggle{ position:fixed; top:14px; left:14px; width:46px; height:46px; border-radius:10px; background:rgba(255,255,255,0.92); border:none; z-index:951; box-shadow:0 6px 16px rgba(2,6,23,0.12); cursor:pointer; }

    footer{ background:linear-gradient(135deg,#10B981,#1486a5); color:#fff; text-align:center; padding:16px; margin-top:28px; }

    /* ---------------- MOBILE-ONLY LAYER ----------------
       Everything inside @media (max-width:960px) is purely mobile behavior.
       Desktop remains unchanged because display: none/visibility & positioning are scoped here.
    --------------------------------------------------*/
    @media (max-width: 960px) {

      /* layout resets - marginTop will be set dynamically via JS to the exact values */
      .layout { grid-template-columns: 1fr; padding: 0; gap: 12px; margin-top: 0; }

      /* Fixed header that never disappears */
      header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1200;
        padding: 12px 12px;
        align-items: flex-start;
        display:flex;
        flex-direction:column;
        gap:6px;
        transition: padding .28s ease, box-shadow .28s ease, background .28s ease;
      }

      header .brand-row { width:100%; gap:12px; align-items:center; justify-content:flex-start; }
      header img { width:86px; height:86px; transition: width .22s ease, height .22s ease, transform .22s ease; }
      header h1 { margin:0; font-size:1.6rem; font-weight:700; text-align:left; transition: font-size .22s ease, transform .22s ease; }
      /* tagline visible but small to fit */
      header p { margin:0; font-size:0.68rem; opacity:1; color: rgba(255,255,255,0.95); transition: opacity .22s ease, transform .22s ease; text-align:left; max-width:calc(100% - 110px); }

      /* header compact state (on scroll) */
      header.compact { padding:8px 12px; box-shadow: 0 8px 26px rgba(2,6,23,0.18); }
      header.compact img { width:48px; height:48px; }
      header.compact h1 { font-size:1.05rem; }
      header.compact p { opacity:0; transform: translateY(-6px); font-size:0.62rem; }

      /* HIDE desktop nav links on mobile - we'll show mobile nav inside overlay */
      nav { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; position:relative; z-index:1199; background:transparent; }
      nav .left-links { display:none; }
      nav .right-section { display:flex; gap:8px; align-items:center; }

      /* SHOW hamburger only on mobile */
      #hamburgerBtn {
        display:inline-flex;
        align-items:center;
        justify-content:center;
        width:46px; height:46px; border-radius:10px; border:none;
        background: rgba(255,255,255,0.98);
        box-shadow:0 6px 20px rgba(2,6,23,0.12);
        cursor:pointer;
        z-index:1220;
        transition: transform .18s ease, box-shadow .18s ease;
      }
      #hamburgerBtn:active { transform: scale(.98); }

      /* hide desktop floating controls and clone them inside overlay via JS */
      #live-datetime, #darkModeToggle { opacity:0; pointer-events:none; transform:translateY(-6px); }

      /* mobile search: fixed below header (visible only on mobile) */
      #mobile-search {
        position: fixed;
        top: 0; /* exact top will be adjusted by JS to header height measurement */
        left: 0;
        right: 0;
        height: var(--search-height);
        z-index:1198;
        display:flex;
        align-items:center;
        justify-content:center;
        padding:8px 12px;
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.02));
        backdrop-filter: blur(6px);
        transition: top .2s ease, opacity .2s ease;
      }
      #mobile-search .search-inner {
        width:100%;
        max-width:980px;
        display:flex;
        gap:8px;
      }
      .search-control {
        display:flex;
        align-items:center;
        width:100%;
        background:#fff;
        border-radius:12px;
        box-shadow:0 6px 18px rgba(2,6,23,0.08);
        padding:8px;
        gap:8px;
      }
      .search-control input {
        border:0; outline:none; font-size:1rem; flex:1;
      }
      .search-control button { border:0; background:linear-gradient(135deg,var(--primary),#60a5fa); color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }

      /* SOLID left-slide overlay */
      .mobile-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 84%;
        max-width: 420px;
        height: 100vh;
        background: #ffffff; /* solid white as requested */
        z-index:1300;
        transform: translateX(-110%);
        transition: transform .34s cubic-bezier(.2,.95,.18,1), box-shadow .25s ease;
        box-shadow: 12px 0 34px rgba(2,6,23,0.16);
        overflow-y:auto;
        -webkit-overflow-scrolling:touch;
        padding: 18px;
      }
      .mobile-overlay.open { transform: translateX(0); }

      .overlay-top { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px; }
      .overlay-top .left { display:flex; gap:10px; align-items:center; }
      .overlay-top .right { display:flex; gap:8px; align-items:center; color:#0b1220; font-weight:600; font-size:13px; }

      .overlay-nav { display:flex; flex-direction:column; gap:6px; margin-top:6px; }
      .overlay-nav a { text-decoration:none; color:#0b1220; padding:12px 8px; border-radius:8px; font-weight:700; font-size:16px; }
      .overlay-nav a:hover { background: rgba(14,165,233,0.06); }

      .overlay-filters { margin-top:14px; background:rgba(246,249,255,0.95); padding:12px; border-radius:10px; box-shadow:0 6px 18px rgba(2,6,23,0.04); }
      .overlay-filters .filter-btn { display:inline-block; margin:6px 6px 6px 0; padding:6px 10px; border-radius:8px; background:#fff; box-shadow:0 4px 10px rgba(2,6,23,0.06); font-weight:600; cursor:pointer; }

      /* page backdrop when overlay open (controlled by body class via JS) */
      body.overlay-active::before{
        content:"";
        position:fixed; inset:0;
        background:rgba(0,0,0,0.28);
        z-index:1295;
        transition: opacity .22s ease;
      }

      /* compact product grid for mobile */
      .product-grid {
        display:grid;
        grid-template-columns: repeat(2, 1fr);
        gap:10px;
        padding:6px;
      }
      .product-card { background:#fff; border-radius:10px; padding:8px; box-shadow:0 4px 14px rgba(2,6,23,0.06); }
      .product-card img { width:100%; height:120px; object-fit:contain; border-radius:6px; }
      .product-card h3 { font-size:0.9rem; margin:6px 0; text-align:left; }
      .product-card p { font-size:0.78rem; color:#475569; height:38px; overflow:hidden; text-align:left; }
      .price { font-weight:700; color:#1a73e8; }

      /* footer adjustments */
      footer { padding:12px; font-size:0.92rem; }
    }

    /* small helpers */
    .hidden { display:none !important; }
    a{color:inherit;}
    button{font-family:inherit;}
  </style>
</head>
<body>

  <!-- Live date/time (desktop visible; will be cloned into overlay on mobile) -->
  <div id="live-datetime" aria-hidden="false"></div>

  <!-- Dark mode (desktop visible; clone into overlay on mobile) -->
  <button id="darkModeToggle" title="Toggle dark mode">üåô</button>

  <!-- HEADER (shared markup; behavior scoped to mobile via CSS + JS) -->
  <header id="topHeader" role="banner" aria-label="Top header">
    <div style="display:flex; width:100%; align-items:center; justify-content:space-between;">
      <!-- Hamburger: only visible on mobile via CSS -->
      <button id="hamburgerBtn" aria-label="Open menu" title="Menu" style="border:none; background:transparent; font-size:22px; display:none;">‚ò∞</button>

      <div class="brand-row" style="margin-left:6px;">
        <img src="logost.png" alt="Stationery logo" id="brandLogo" />
        <div style="display:flex; flex-direction:column;">
          <h1 id="brandTitle">Stationery Mall üõí</h1>
          <!-- small tagline visible on load -->
          <p id="brandTagline" style="margin-top:4px; color:rgba(255,255,255,0.95);">One-stop for books & stationery ‚Äî curated deals from trusted stores.</p>
        </div>
      </div>

      <!-- spacer (desktop will show floating controls visually) -->
      <div style="width:46px; height:46px; margin-right:6px;"></div>
    </div>
  </header>

  <!-- MOBILE SEARCH (fixed below header on mobile). Hidden by default; shown in mobile media via JS/CSS. -->
  <div id="mobile-search" aria-hidden="true" style="display:none;">
    <div class="search-inner">
      <div class="search-control" role="search" aria-label="Search products">
        <input id="mobileSearchInput" type="search" placeholder="Search books, pens, notebooks..." aria-label="Search products" />
        <button id="mobileSearchBtn" aria-label="Search">üîç</button>
      </div>
    </div>
  </div>

  <!-- NAV (desktop) -->
  <nav>
    <div class="left-links" id="navLinks">
      <a href="index.html">Home</a>
      <a href="#about">About</a>
      <a href="#faq">FAQ</a>
      <a href="#disclaimer">Disclaimer</a>
    </div>

    <div class="right-section">
      <!-- Desktop search (kept untouched) -->
      <div id="desktopSearch" style="display:flex; align-items:center; gap:8px;">
        <div style="display:flex; background:#fff; padding:6px; border-radius:10px; align-items:center; box-shadow:0 6px 18px rgba(2,6,23,0.06);">
          <input id="desktopSearchInput" type="text" placeholder="Search products..." style="border:0; outline:none; padding:8px; width:220px;" aria-label="Search products" />
          <button id="desktopSearchBtn" style="padding:8px 10px; background:linear-gradient(135deg,var(--primary),#60a5fa); color:#fff; border-radius:6px; border:none; cursor:pointer;">üîç</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- MOBILE OVERLAY: solid white left-side panel -->
  <aside class="mobile-overlay" id="mobileOverlay" aria-hidden="true" role="dialog" aria-label="Mobile menu">
    <div id="overlayInner">
      <div class="overlay-top">
        <div class="left" id="overlayDarkContainer" aria-hidden="true"></div>
        <div class="right" id="overlayDateContainer" aria-hidden="true"></div>
      </div>

      <nav class="overlay-nav" aria-label="Mobile navigation">
        <a href="index.html">Home</a>
        <a href="#about">About</a>
        <a href="#faq">FAQ</a>
        <a href="#disclaimer">Disclaimer</a>
      </nav>

      <div class="overlay-filters" id="overlayFiltersArea">
        <strong>Filters</strong>
        <div style="margin-top:8px;" id="overlayFilterButtons"></div>
      </div>

      <div style="margin-top:18px;">
        <button id="closeOverlayBtn" style="padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(135deg,var(--primary),#60a5fa);color:white;font-weight:700;cursor:pointer;">Close menu</button>
      </div>
    </div>
  </aside>

  <!-- Ticker -->
  <div class="ticker" style="width:100%; overflow:hidden; background:linear-gradient(90deg,#2563eb,#10b981); color:white; font-weight:600; padding:8px 0; margin-top:0;">
    <div class="ticker__content" id="tickerText"></div>
  </div>

  <!-- MAIN LAYOUT -->
  <main class="layout" id="pageContent" role="main">
    <aside class="filters" id="filtersPanel">
      <h3>Filters</h3>
      <div id="filterList"></div>
      <div style="margin-top:10px;">
        <button id="clearFilters">Clear</button>
        <button id="saveFiltersBtn">Save</button>
      </div>
    </aside>

    <section class="main">
      <div class="container">
        <div class="product-grid" id="productGrid"></div>
      </div>

      <section class="info-sections" style="padding:0 12px;">
        <div class="info-container">
          <div class="info-box" id="about">
            <h2>About Us</h2>
            <p>Stationery Mall is a one-stop destination for books and stationery ‚Äî curated options from trusted marketplaces.</p>
          </div>
          <div class="info-box" id="disclaimer">
            <h2>Disclaimer</h2>
            <p>We participate in affiliate programs with Flipkart, Amazon, Meesho. Prices & availability are controlled by those sites.</p>
          </div>
          <div class="info-box" id="faq">
            <h2>FAQ</h2>
            <details>
              <summary>Why order from here?</summary>
              <p>Curated products, best-available deals, and simple browsing ‚Äî no extra charges for you.</p>
            </details>
          </div>
        </div>
      </section>
    </section>
  </main>

  <footer>
    <div>&copy; 2025 Ibrar Classes</div>
    <div id="visitor-info" style="margin-top:6px; font-weight:600;"></div>
  </footer>

  <!-- floating chat -->
  <a id="molly-chat" href="https://t.me/M1ssMolly_Bot" target="_blank" rel="noopener" title="Chat with Miss Molly" style="position:fixed;right:18px;bottom:18px;z-index:1400;">
    <img src="images/miss-molly.jpg" alt="Miss Molly" style="width:66px;height:66px;border-radius:50%;box-shadow:0 8px 26px rgba(3,10,23,.18);" />
  </a>

  <button id="back-to-top" aria-label="Back to top" style="position:fixed;right:20px;bottom:96px;display:none; z-index:1400; background:var(--primary); color:#fff; border:none; width:46px; height:46px; border-radius:50%;">‚Üë</button>

  <!-- ===== SCRIPTS ===== -->
  <script>
    /* ---------- Small helpers ---------- */
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    /* ---------------- Live Date/Time ---------------- */
    const liveDateEl = $('#live-datetime');
    function updateDateTime() {
      const now = new Date();
      const dateStr = now.toLocaleDateString('en-IN', { weekday:'short', year:'numeric', month:'short', day:'numeric' });
      const timeStr = now.toLocaleTimeString('en-IN');
      if(liveDateEl) liveDateEl.textContent = `${dateStr} | ${timeStr}`;
      const overlayDate = $('#overlayDateContainer');
      if(overlayDate) overlayDate.textContent = `${dateStr} ‚Ä¢ ${timeStr}`;
    }
    updateDateTime(); setInterval(updateDateTime, 1000);

    /* ---------------- Dark Mode toggle ---------------- */
    const darkToggle = $('#darkModeToggle');
    if(localStorage.getItem('ibrar-dark') === '1') {
      document.documentElement.classList.add('dark-mode');
      if(darkToggle) darkToggle.textContent = '‚òÄÔ∏è';
    }
    if(darkToggle) darkToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark-mode');
      const on = document.documentElement.classList.contains('dark-mode');
      localStorage.setItem('ibrar-dark', on ? '1' : '0');
      darkToggle.textContent = on ? '‚òÄÔ∏è' : 'üåô';
    });

    /* ---------------- Ticker ---------------- */
    (function initTicker(){
      const msgs = [
        "üõí Affiliate links to Flipkart, Amazon & Meesho ‚Äî we may earn a small fee.",
        "üì¶ Products updated regularly for the best deals.",
        "‚ù§Ô∏è Handpicked products for students ‚Äî curated with care.",
        "üîç Use the search bar to find items quickly."
      ];
      const el = $('#tickerText');
      if(!el) return;
      let i = 0;
      function show(){ el.textContent = msgs[i]; i = (i+1) % msgs.length; setTimeout(show, 5000); }
      show();
    })();

    /* ---------------- Products & Filters (demo static data) ---------------- */
    (function productModule(){
      const grid = $('#productGrid');
      const filterListEl = $('#filterList');
      const overlayFilterButtons = $('#overlayFilterButtons');
      const demoProducts = [
        { title:'A4 Notebook', desc:'210 pages, spiral', price:'‚Çπ139', image:'https://via.placeholder.com/300x300?text=Notebook', category:'Notebooks' },
        { title:'Ball Pen (Pack)', desc:'Smooth writing', price:'‚Çπ89', image:'https://via.placeholder.com/300x300?text=Pen', category:'Pens' },
        { title:'Sketch Book', desc:'Unruled, A4', price:'‚Çπ149', image:'https://via.placeholder.com/300x300?text=Sketch', category:'Notebooks' },
        { title:'Highlighter set', desc:'5 colors', price:'‚Çπ159', image:'https://via.placeholder.com/300x300?text=Highlighter', category:'Accessories' },
        { title:'Exam Preparation Book', desc:'Complete syllabus', price:'‚Çπ399', image:'https://via.placeholder.com/300x300?text=Book', category:'Books' },
        { title:'Stapler', desc:'Heavy duty', price:'‚Çπ199', image:'https://via.placeholder.com/300x300?text=Stapler', category:'Accessories' },
        { title:'Pencil Pack', desc:'12 pencils', price:'‚Çπ59', image:'https://via.placeholder.com/300x300?text=Pencil', category:'Pens' },
        { title:'Desk Organizer', desc:'Keep tidy', price:'‚Çπ299', image:'https://via.placeholder.com/300x300?text=Organizer', category:'Gadgets' }
      ];
      const categories = Array.from(new Set(demoProducts.map(p => p.category)));
      let activeFilters = [];

      function renderFilters(){
        filterListEl.innerHTML = '';
        overlayFilterButtons.innerHTML = '';
        categories.forEach(cat => {
          const lab = document.createElement('label');
          lab.style.display='flex'; lab.style.gap='8px'; lab.style.alignItems='center'; lab.style.marginBottom='6px';
          const chk = document.createElement('input'); chk.type='checkbox'; chk.value=cat;
          chk.addEventListener('change', () => { syncFilters(); renderProducts(); });
          lab.appendChild(chk);
          const span = document.createElement('span'); span.textContent = cat; lab.appendChild(span);
          filterListEl.appendChild(lab);

          const fbtn = document.createElement('button'); fbtn.className='filter-btn'; fbtn.textContent = cat;
          fbtn.addEventListener('click', () => {
            if(activeFilters.includes(cat)) activeFilters = activeFilters.filter(x => x !== cat);
            else activeFilters.push(cat);
            // sync checkboxes
            filterListEl.querySelectorAll('input[type="checkbox"]').forEach(i => { if(activeFilters.includes(i.value)) i.checked=true; else i.checked=false; });
            renderProducts();
          });
          overlayFilterButtons.appendChild(fbtn);
        });
      }

      function syncFilters(){ activeFilters = Array.from(filterListEl.querySelectorAll('input[type="checkbox"]:checked')).map(i => i.value); }

      function renderProducts(){
        const q = ($('#mobileSearchInput')?.value || $('#desktopSearchInput')?.value || '').toLowerCase().trim();
        let list = demoProducts.slice();
        if(activeFilters.length) list = list.filter(p => activeFilters.includes(p.category));
        if(q) list = list.filter(p => (p.title + ' ' + p.desc + ' ' + p.category).toLowerCase().includes(q));
        grid.innerHTML = '';
        if(!list.length) { grid.innerHTML = '<p style="grid-column:1/-1;text-align:center;color:#475569">No items found</p>'; return; }
        list.forEach(p => {
          const card = document.createElement('div'); card.className = 'product-card';
          card.innerHTML = `<img src="${p.image}" alt="${p.title}" loading="lazy"><h3>${p.title}</h3><p>${p.desc}</p><div style="display:flex;align-items:center;justify-content:space-between;"><span class="price">${p.price}</span><a class="buy-btn" href="#" style="text-decoration:none;padding:6px 10px;border-radius:8px;background:linear-gradient(135deg,#2563eb,#3b82f6);color:#fff;font-weight:700;">Buy</a></div>`;
          grid.appendChild(card);
        });
      }

      $('#mobileSearchBtn')?.addEventListener('click', renderProducts);
      $('#desktopSearchBtn')?.addEventListener('click', renderProducts);
      $('#mobileSearchInput')?.addEventListener('keyup', e => { if(e.key === 'Enter') renderProducts(); });
      $('#desktopSearchInput')?.addEventListener('keyup', e => { if(e.key === 'Enter') renderProducts(); });

      renderFilters();
      renderProducts();
    })();

    /* ---------------- Mobile UX: header shrink, fixed search, left overlay ---------------- */
    (function mobileUX(){
      const mq = window.matchMedia('(max-width:960px)');
      const hamburger = $('#hamburgerBtn');
      const overlay = $('#mobileOverlay');
      const closeOverlayBtn = $('#closeOverlayBtn');
      const overlayDarkContainer = $('#overlayDarkContainer');
      const overlayDateContainer = $('#overlayDateContainer');
      const mobileSearch = $('#mobile-search');
      const topHeader = $('#topHeader');
      const body = document.body;

      // measure and set offsets so content doesn't hide under fixed header+search
      function setContentOffset(){
        if(!mq.matches){
          $('#pageContent').style.marginTop = '';
          // show desktop floating controls
          if($('#live-datetime')) $('#live-datetime').style.opacity = '';
          if($('#darkModeToggle')) $('#darkModeToggle').style.opacity = '';
          return;
        }
        // header may change height when 'compact'; measure actual heights
        const headerRect = topHeader.getBoundingClientRect();
        const headerHeight = Math.ceil(headerRect.height);
        const searchRect = mobileSearch.getBoundingClientRect();
        const searchHeight = Math.ceil(searchRect.height) || parseInt(getComputedStyle(document.documentElement).getPropertyValue('--search-height')) || 60;
        const total = headerHeight + searchHeight + 12; // small gap
        $('#pageContent').style.marginTop = total + 'px';
        // place mobile-search directly below header
        mobileSearch.style.top = headerHeight + 'px';
      }

      function showMobileElements(){
        if(!mq.matches) return;
        // show hamburger and mobile-search
        if(hamburger) hamburger.style.display = 'inline-flex';
        if(mobileSearch) mobileSearch.style.display = 'flex';
        // clone dark toggle into overlay if not present
        if(overlayDarkContainer && !$('#overlayDarkBtn') && $('#darkModeToggle')){
          const orig = $('#darkModeToggle');
          const clone = orig.cloneNode(true);
          clone.id = 'overlayDarkBtn';
          clone.style.background = 'transparent';
          clone.style.border = '1px solid rgba(0,0,0,0.06)';
          clone.style.padding = '6px 8px';
          clone.style.borderRadius = '8px';
          clone.addEventListener('click', () => { orig.click(); });
          overlayDarkContainer.appendChild(clone);
        }
        // ensure overlay date/time shows
        updateDateTime();
      }

      function hideMobileElements(){
        if(hamburger) hamburger.style.display = 'none';
        if(mobileSearch) mobileSearch.style.display = 'none';
        const c = $('#overlayDarkBtn'); if(c && c.parentNode) c.parentNode.removeChild(c);
      }

      // overlay open/close
      function openOverlay(){
        overlay.classList.add('open');
        overlay.setAttribute('aria-hidden','false');
        body.classList.add('overlay-active');
        document.body.style.overflow = 'hidden';
      }
      function closeOverlay(){
        overlay.classList.remove('open');
        overlay.setAttribute('aria-hidden','true');
        body.classList.remove('overlay-active');
        document.body.style.overflow = '';
      }

      // click handlers
      hamburger?.addEventListener('click', () => { if(overlay.classList.contains('open')) closeOverlay(); else openOverlay(); });
      closeOverlayBtn?.addEventListener('click', closeOverlay);

      // close when clicking outside overlay
      document.addEventListener('click', (e) => {
        if(!mq.matches) return;
        if(!overlay.classList.contains('open')) return;
        const isInside = overlay.contains(e.target) || (hamburger && hamburger.contains(e.target));
        if(!isInside) closeOverlay();
      });

      // header shrink behavior (only toggles .compact; header never disappears)
      let lastScroll = 0;
      function onScroll(){
        if(!mq.matches){ topHeader.classList.remove('compact'); setContentOffset(); return; }
        const sc = window.scrollY || document.documentElement.scrollTop;
        if(sc > 48) topHeader.classList.add('compact');
        else topHeader.classList.remove('compact');
        // update offsets when header size changes
        setContentOffset();
        lastScroll = sc;
      }

      // initial & responsive
      function onResize(){
        if(mq.matches) showMobileElements(); else hideMobileElements();
        // small delay to allow layout recalculation
        setTimeout(setContentOffset, 50);
      }

      window.addEventListener('resize', onResize);
      window.addEventListener('orientationchange', onResize);
      window.addEventListener('scroll', onScroll, { passive:true });

      // run once
      onResize();
      onScroll();
    })();

    /* ---------------- Adjust content offset on load and when fonts/images change ---------------- */
    (function adjustOnLoad(){
      window.addEventListener('load', () => {
        // force recalculation after small delay (images/fonts loaded)
        setTimeout(() => { window.dispatchEvent(new Event('resize')); }, 120);
      });
    })();

    /* ---------------- back-to-top ---------------- */
    (function backToTop(){
      const btn = $('#back-to-top');
      window.addEventListener('scroll', () => { if(window.scrollY > 280) btn.style.display='block'; else btn.style.display='none'; });
      btn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    })();

    /* ---------------- visitor-counter demo ---------------- */
    (function visitorCounter(){
      const vi = $('#visitor-info');
      if(!vi) return;
      let count = parseInt(localStorage.getItem('ibrar_visitors') || '72', 10);
      function tick(){ if(Math.random()<0.4) count = Math.min(999, count + Math.floor(Math.random()*3)); localStorage.setItem('ibrar_visitors', count); vi.innerHTML = `Visitors this month: <strong>${count}</strong>`; }
      tick(); setInterval(tick, 8000);
    })();

  </script>
</body>
</html>
